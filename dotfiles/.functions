function rl() {
    echo "Reload shell ${SHELL}"
    exec ${SHELL} -l
}

function colors() {
    for c in {000..255}; do
        echo -n "\e[38;5;${c}m $c"
        [ $(($c%16)) -eq 15 ] && echo
    done; echo
}

function vgrep() {
    vim -p $(grep -Filr "${1}" ${2:-.})
}

function jupyter() {
    docker run --rm -it \
        -e AWS_PROFILE=${AWS_PROFILE} \
        -v ${HOME}/.aws:/home/jovyan/.aws \
        -v ${HOME}/.jupyter:/home/jovyan/.jupyter \
        -v $(pwd):/home/jovyan/work \
        -w /home/jovyan/work \
        -p 8888:8888 \
        jupyter/datascience-notebook:latest \
        start-notebook.sh --NotebookApp.token=""
}

function peco_search_aws_profile() {
    local r=$(grep '^\[.*\]' ~/.aws/credentials | tr -d '[]'| sort | peco)
    if [ -n "${r}" ]; then
        export AWS_PROFILE=${r}
    else
        unset AWS_PROFILE
    fi
    zle reset-prompt
}

function peco_search_ghq_look() {
    local r=$(ghq list | sort | peco)
    [ -n "${r}" ] && cd $(ghq root)/${r}
    zle reset-prompt
}

function peco_search_git_branch() {
    local r=$(git branch --format='%(refname:short)' | cut -d' ' -f 2 | sort | peco)
    [ -n "${r}" ] && git checkout ${r}
    zle reset-prompt
}

function peco_search_history() {
    BUFFER=$(history -n 1 | tail -r | awk '!a[$0]++' | peco)
    CURSOR=$#BUFFER
    zle reset-prompt
}

function peco_search_find() {
    local r=$(find . -type f | peco)
    [ -n "${r}" ] && vim --not-a-term ${r}
    zle reset-prompt
}

function peco_search_word() {
    local r=$(find . -type f | peco)
    [ -n "${r}" ] && vim --not-a-term ${r}
    zle reset-prompt
}

function peco_search_word() {
    local r=$(rg "${1}" ${2:-.} | peco)
    [ -n "${r}" ] && vim --not-a-term ${r}
    zle reset-prompt
}

zle -N peco_search_aws_profile
bindkey '^A' peco_search_aws_profile

zle -N peco_search_ghq_look
bindkey '^G' peco_search_ghq_look

zle -N peco_search_git_branch
bindkey '^B' peco_search_git_branch

zle -N peco_search_history
bindkey '^H' peco_search_history

zle -N peco_search_find
bindkey '^F' peco_search_find

zle -N peco_search_word
bindkey '^W' peco_search_word

chpwd() { l }
